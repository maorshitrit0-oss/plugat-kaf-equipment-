<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>דיווח תקלה - פלוגה כ׳</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Assistant:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Assistant', sans-serif; background: #fff3e0; padding: 20px; display: flex; justify-content: center; }
        .card { background: white; padding: 25px; border-radius: 12px; width: 100%; max-width: 500px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); border-top: 6px solid #f57c00; }
        .form-group { margin-bottom: 15px; text-align: right; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input, select, textarea { width: 100%; padding: 12px; border: 1px solid #ccc; border-radius: 6px; font-family: inherit; font-size: 1rem; }
        .btn { width: 100%; background: #f57c00; color: white; border: none; padding: 14px; border-radius: 6px; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState } = React;
        function FaultForm() {
            const [status, setStatus] = useState('idle');
            const [form, setForm] = useState({ name: '', id: '', unit: 'מחלקה 1', type: 'קשר 624', desc: '', otherText: '' });

            const send = async (e) => {
                e.preventDefault();
                if (form.id.toString().length !== 7) return alert('מספר אישי חייב להיות 7 ספרות בדיוק');
                setStatus('sending');
                const data = { 
                    soldierName: form.name, 
                    soldierId: form.id, 
                    unit: form.unit, 
                    equipmentType: form.type === 'אחר' ? `אחר: ${form.otherText}` : form.type,
                    description: form.desc,
                    date: new Date().toISOString(),
                    status: 'pending',
                    id: Date.now()
                };
                await fetch('https://plugat-kaf-default-rtdb.firebaseio.com/faults.json', { method: 'POST', body: JSON.stringify(data) });
                setStatus('done');
            };

            if (status === 'done') return <div className="card"><h2>✓ הדיווח נשלח בהצלחה!</h2><button className="btn" onClick={() => window.location.reload()}>דיווח נוסף</button></div>;

            return (
                <div className="card">
                    <h2 style={{textAlign:'center', color:'#e65100'}}>דיווח תקלה פלוגתי</h2>
                    <form onSubmit={send}>
                        <div className="form-group"><label>שם מלא</label><input required onChange={e => setForm({...form, name: e.target.value})} /></div>
                        <div className="form-group"><label>מספר אישי (7 ספרות)</label><input required type="number" onChange={e => setForm({...form, id: e.target.value})} /></div>
                        <div className="form-group"><label>מחלקה</label><select onChange={e => setForm({...form, unit: e.target.value})}>{['מחלקה 1','מחלקה 2','מחלקה 3','חפק','חמל','מפלג'].map(u => <option key={u}>{u}</option>)}</select></div>
                        <div className="form-group">
                            <label>סוג ציוד</label>
                            <select onChange={e => setForm({...form, type: e.target.value})}>
                                <option>קשר 624</option><option>ליונט</option><option>מעד</option><option>קשור לרכב החפ"ק</option><option>אחר</option>
                            </select>
                        </div>
                        {form.type === 'אחר' && (
                            <div className="form-group"><label>פרט איזה ציוד:</label><input required placeholder="פרט כאן מה הציוד" onChange={e => setForm({...form, otherText: e.target.value})} /></div>
                        )}
                        <div className="form-group"><label>תיאור התקלה</label><textarea required onChange={e => setForm({...form, desc: e.target.value})} /></div>
                        <button className="btn" disabled={status === 'sending'}>{status === 'sending' ? 'שולח...' : 'שלח דיווח'}</button>
                    </form>
                </div>
            );
        }
        ReactDOM.render(<FaultForm />, document.getElementById('root'));
    </script>
</body>
</html>
