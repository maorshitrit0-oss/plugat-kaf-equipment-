<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ניהול ציוד פלוגתי - Firebase</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@400;700&family=Assistant:wght@400;600&display=swap" rel="stylesheet">
    <style>
        /* כאן נשאר ה-CSS המקורי שלך (הושמט לצורך קיצור, השאר אותו כפי שהוא) */
        body { font-family: 'Assistant', sans-serif; background: #f5f5f5; }
        .section { background: white; padding: 20px; margin: 20px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: right; }
        th { background-color: #2c5f2d; color: white; }
        .fault-pending { background-color: #fff3e0; border-right: 4px solid #ff9800; padding: 10px; margin: 5px 0; }
        .btn { background: #2c5f2d; color: white; border: none; padding: 5px 10px; cursor: pointer; border-radius: 4px; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // הגדרות Firebase
        const firebaseConfig = {
            databaseURL: "https://plugat-kaf-default-rtdb.firebaseio.com"
        };
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const db = firebase.database();

        function App() {
            const [checkouts, setCheckouts] = useState([]);
            const [faults, setFaults] = useState([]);

            useEffect(() => {
                // משיכת חתימות ציוד מ-Firebase
                const checkoutsRef = db.ref('checkouts');
                checkoutsRef.on('value', (snapshot) => {
                    const data = snapshot.val();
                    const list = data ? Object.values(data) : [];
                    setCheckouts(list.reverse()); // מציג חדש למעלה
                });

                // משיכת תקלות מ-Firebase
                const faultsRef = db.ref('faults');
                faultsRef.on('value', (snapshot) => {
                    const data = snapshot.val();
                    const list = data ? Object.entries(data).map(([id, val]) => ({...val, id})) : [];
                    setFaults(list);
                });

                return () => {
                    checkoutsRef.off();
                    faultsRef.off();
                };
            }, []);

            const updateFaultStatus = (faultId, newStatus) => {
                db.ref(`faults/${faultId}`).update({ status: newStatus });
            };

            const pendingFaults = faults.filter(f => f.status === 'pending');
            const resolvedFaults = faults.filter(f => f.status === 'resolved');

            return (
                <div className="container">
                    <div className="section">
                        <h2>חתימות ציוד אחרונות</h2>
                        <table>
                            <thead>
                                <tr>
                                    <th>שם חייל</th>
                                    <th>מחלקה</th>
                                    <th>ציוד שנחתם</th>
                                    <th>תאריך</th>
                                </tr>
                            </thead>
                            <tbody>
                                {checkouts.map((c, i) => (
                                    <tr key={i}>
                                        <td>{c.soldierName}</td>
                                        <td>{c.unit}</td>
                                        <td>{c.equipment?.join(', ')}</td>
                                        <td>{new Date(c.timestamp).toLocaleString('he-IL')}</td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>

                    <div className="section">
                        <h2>דיווחים על תקלות בטיפול</h2>
                        {pendingFaults.length === 0 ? <p>אין תקלות פתוחות</p> : 
                            pendingFaults.map(f => (
                                <div key={f.id} className="fault-pending">
                                    <strong>{f.soldierName}</strong> (מחלקה {f.unit}): {f.equipmentType}
                                    <p>{f.description}</p>
                                    <button className="btn" onClick={() => updateFaultStatus(f.id, 'resolved')}>סמן כטופל ✓</button>
                                </div>
                            ))
                        }
                    </div>
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>